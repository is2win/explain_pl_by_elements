Методология распределения изменения стоимости деривативного контракта по компонентам

Оглавление
Методология распределения изменения стоимости деривативного контракта по компонентам	1
Введение	1
Примеры	1
Пример 1	2
Пример 2.	2
Пример 3.	3
Методология	3

Введение

Задача – дана стоимость контракта на 2 даты, необходимо распределить разницу в стоимости по различным компонентам, так, чтобы сумма компонентов равнялась разнице в стоимости, а каждый компонент представлял из себя «экономический» риск фактор. 

Дано: 
	•	контракт со всеми его параметрами, включая «валюту номинала».
	•	«дата_было», «дата_стало»
	•	«PV_было», «PV_стало» (стоимость контракта в валюте номинала на соответствующие даты), «total_diff» их разница total_diff. 
	•	набор рыночных данных на «дата_было», «дата_стало». 


Общий принцип заключается в последовательном переходе от набора рыночных данных на «дата_было» на набор рыночных данных на «дата_стало», и подсчет соответствующих изменений в стоимости. Однако, есть ряд усложнений, связанный с движением времени между «дата_было», «дата_стало», многомерного характера рыночных данных, а также особенностей используемых моделей переоценки. 



Примеры

Пример 1: 
	•	контракт - безрисковый Zero Coupon Bond, в рублях с погашением 30.11.2025 и номиналом 1000.00р
	•	«дата_было» = 29.07.2025 «дата_стало» = 30.07.2025
	•	«PV_было» = 939.94, «PV_стало» = 940,41
	•	Ставка 20% годовых (ACT/365, annual compounding).





Между «дата_было», и «дата_стало» не было никаких изменений в рыночных данных, просто прошел 1 день. 

Посчитаем 2 показателя:
	•	theta – разница в стоимости контракта между 
	•	«PV, посчитанного на рыночных данных на «дата_было», но в «дату_стало»», и 
	•	PV_было. В данном случае, «PV, посчитанного на рыночных данных на «дата_было», но в «дату_стало» это просто «PV_стало», и theta =total_diff
	•	В качестве проверки а также объяснения экономического смысла theta, посчитаем carry – стоимость фондирования на балансе актива на срок с «даты_было» по «дату_стало» по дисконтирующей кривой по состоянию на «дату_было». В данном случае совпадает с тэтой и total_diff. Вообще говоря carry является компонентом theta.

В итоге, можно записать следующее распределение по компонентам: total_diff = theta   (детализация: theta = carry)

Пример 2. Все аналогично контракту 2, но ставка дисконтирования в дату_стало равна 21% а не 20%. Theta и carry не поменялись (их определение не зависит от рыночных данных на «дату_стало»). 

Посчитаем компонент rho: разница между «PV, посчитанного на рыночных данных на «дата_было», но в «дату_стало» (то есть используемого для подсчета theta) и аналогичного, но с новой %% кривой (см эксель) 





Пример 3. В контракте появился промежуточный купон в 10р, который выплачивается в «дату_стало» (как результат, стоимость контракта на «дату_стало» уже не включает в себя величину купона). Теперь theta отличается от carry, и содержит изменение стоимости, связанное с отсечкой по купону:







Методология

Выберем следующую последовательность для выстраивания explain

Шаг
Имя
Что двигаем
1
spot
Значение спот базовых активов (включая fx)
2
implied_vol
Волатильности
3
implied_divs
Дивиденды
4
theta
Дату оценки
5
rates
Ставки



Каждый из компонент требует дальнейшей детализации для корректного отнесения на «экономические» риск факторы. 

	•	Spot -необходимо разложить в ряд Тейлора до второго порядка, то есть посчитать spot_delta(по каждому активу), spot_cross_gamma (по каждой паре активов) и spot_residual(просто остаток)):
	•	spot_delta: по каждому активу, считаем delta как оценку производной (изменение цены контракта при небольшом изменении цены актива) и умножаем на фактическое изменение стоимости актива. 
	•	spot_gross_gamma: 
	•	по каждой из   паре активов, считаем показатель cross_gamma как оценку второй производной цены контракта по изменению цены 2 базовых активов. Перемножаем на фактическое изменение стоимостей базовых активов. Запоминаем значения для каждой пары ба. Суммируем для целей подсчета суммарной spot_cross gamma. 
	•	По каждому из n активов считаем вторую производную по изменению цены данного актива, умножаем на квадрат фактических изменений, делим на 2. Запоминаем значения для каждого ба. Суммируем для целей подсчета суммарной spot_cross_gamma.
	•	spot_residual: spot – spot_delta – spot_cross_gamma

	•	implied_vol – последовательно меняем волатильности для каждого актива (упорядочив базовые активы например по ISIN по возрастанию), запоминаем значения для каждого ба. Сумма по всем активам должна совпадать с итоговой implied_vol.

	•	implied_divs – аналогично implied_vol.


	•	theta – разбиваем на bs_carry, cash, dvd_carry, hedge_carry, time_decay:
	•	bs_carry – как в примерах выше(«pv_было» на ставку)
	•	cashflow – как в примерах выше(сумма выплат по контракту в «дату_стало»)
	•	dvd_decay – аналитически, по каждому ба, по которому есть ненулевой dvd_yield – теоретическая стоимость хеджа (delta по ба, посчитанная в 1.а * стоимость ба) * (EXP (значение dvd_yield на начало периода/365)-1).
	•	hedge_carry – аналитически, по каждому ба, теоретическая стоимость хеджа (delta по ба, посчитанная в 1.а * стоимость ба) *EXP(проецирующая ставка на начало периода*количество дней (между дата_стало и дата было)/365)-1
	•	time_decay: остаток между theta и компонентами 4а,4b,4c,4d.
